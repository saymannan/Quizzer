function NewCal(e,t,n,r){Cal=new Calendar(dtToday);if(n!=null&&n){Cal.ShowTime=true;if(r!=null&&(r=="12"||r=="24")){TimeMode=r}}if(e!=null)Cal.Ctrl=e;if(t!=null)Cal.Format=t.toUpperCase();exDateTime=document.getElementById(e).value;if(exDateTime!=""){var i;var s;var o;var o;var u;var a;var f;var l;var c;var h;var p;var d;i=exDateTime.indexOf(DateSeparator,0);s=exDateTime.indexOf(DateSeparator,parseInt(i)+1);if(Cal.Format.toUpperCase()=="DDMMYYYY"||Cal.Format.toUpperCase()=="DDMMMYYYY"){u=exDateTime.substring(i+1,s);a=exDateTime.substring(0,i)}else if(Cal.Format.toUpperCase()=="MMDDYYYY"||Cal.Format.toUpperCase()=="MMMDDYYYY"){u=exDateTime.substring(0,i);a=exDateTime.substring(i+1,s)}if(isNaN(u))l=Cal.GetMonthIndex(u);else l=parseInt(u,10)-1;if(parseInt(l,10)>=0&&parseInt(l,10)<12)Cal.Month=l;if(parseInt(a,10)<=Cal.GetMonDays()&&parseInt(a,10)>=1)Cal.Date=a;f=exDateTime.substring(s+1,s+5);c=/^\d{4}$/;if(c.test(f))Cal.Year=parseInt(f,10);if(Cal.ShowTime==true){o=exDateTime.indexOf(":",0);tSp2=exDateTime.indexOf(":",parseInt(o)+1);h=exDateTime.substring(o,o-2);Cal.SetHour(h);p=exDateTime.substring(o+1,tSp2);Cal.SetMinute(p);d=exDateTime.substring(tSp2+1,tSp2+3);Cal.SetSecond(d)}}winCal=window.open("","DateTimePicker","toolbar=0,status=0,menubar=0,fullscreen=no,width=195,height=245,resizable=0,top="+cnTop+",left="+cnLeft);docCal=winCal.document;RenderCal()}function RenderCal(){var e;var t;var n;var r;var i;var s;var o=0;var u;docCal.open();docCal.writeln("<html><head><title>"+WindowTitle+"</title>");docCal.writeln("<script>var winMain=window.opener;</script>");docCal.writeln("</head><body background='"+ThemeBg+"' link="+FontColor+" vlink="+FontColor+"><form name='Calendar'>");e='<table border=1 cellpadding=1 cellspacing=1 width=\'100%\' align="center" valign="top">\n';e+="<tr>\n<td colspan='7'><table border=0 width='100%' cellpadding=0 cellspacing=0><tr><td align='left'>\n";e+='<select name="MonthSelector" onChange="javascript:winMain.Cal.SwitchMth(this.selectedIndex);winMain.RenderCal();">\n';for(r=0;r<12;r++){if(r==Cal.Month)s="Selected";else s="";e+="<option "+s+" value >"+MonthName[r]+"\n"}e+="</select></td>";e+='\n<td align=\'right\'><a href="javascript:winMain.Cal.DecYear();winMain.RenderCal()"><b><font color="'+YrSelColor+'"><</font></b></a><font face="Verdana" color="'+YrSelColor+'" size=2><b> '+Cal.Year+' </b></font><a href="javascript:winMain.Cal.IncYear();winMain.RenderCal()"><b><font color="'+YrSelColor+'">></font></b></a></td></tr></table></td>\n';e+="</tr>";if(ShowMonthYear)e+="<tr><td colspan='7'><font face='Verdana' size='2' align='center' color='"+MonthYearColor+"'><b>"+Cal.GetMonthName(ShowLongMonth)+" "+Cal.Year+"</b></font></td></tr>\n";e+="<tr bgcolor="+WeekHeadColor+">";for(r=0;r<7;r++){e+="<td align='center'><font face='Verdana' size='2'>"+WeekDayName[r].substr(0,WeekChar)+"</font></td>"}e+="</tr>";docCal.write(e);CalDate=new Date(Cal.Year,Cal.Month);CalDate.setDate(1);u=CalDate.getDay();t="<tr>";for(r=0;r<u;r++){t=t+GenCell();o=o+1}for(i=1;i<=Cal.GetMonDays();i++){var a;o=o+1;if(i==dtToday.getDate()&&Cal.Month==dtToday.getMonth()&&Cal.Year==dtToday.getFullYear())a=GenCell(i,true,TodayColor);else{if(i==Cal.Date){a=GenCell(i,true,SelDateColor)}else{if(o%7==0)a=GenCell(i,false,SaturdayColor);else if((o+6)%7==0)a=GenCell(i,false,SundayColor);else a=GenCell(i,null,WeekDayColor)}}t=t+a;if(o%7==0&&i<Cal.GetMonDays()){t=t+"</tr>\n<tr>"}}docCal.writeln(t);if(Cal.ShowTime){var f;f=Cal.getShowHour();n="<tr>\n<td colspan='7' align='center'>";n+="<input type='text' name='hour' maxlength=2 size=1 style=\"WIDTH: 22px\" value="+f+' onchange="javascript:winMain.Cal.SetHour(this.value)">';n+=" : ";n+="<input type='text' name='minute' maxlength=2 size=1 style=\"WIDTH: 22px\" value="+Cal.Minutes+' onchange="javascript:winMain.Cal.SetMinute(this.value)">';n+=" : ";n+="<input type='text' name='second' maxlength=2 size=1 style=\"WIDTH: 22px\" value="+Cal.Seconds+' onchange="javascript:winMain.Cal.SetSecond(this.value)">';if(TimeMode==12){var l=parseInt(Cal.Hours,10)<12?"Selected":"";var c=parseInt(Cal.Hours,10)>=12?"Selected":"";n+='<select name="ampm" onchange="javascript:winMain.Cal.SetAmPm(this.options[this.selectedIndex].value);">';n+="<option "+l+' value="AM">AM</option>';n+="<option "+c+' value="PM">PM<option>';n+="</select>"}n+="\n</td>\n</tr>";docCal.write(n)}docCal.writeln("\n</table>");docCal.writeln("</form></body></html>");docCal.close()}function GenCell(e,t,n){var r;var i;var s;var o;var u;var a;if(e==null)r="";else r=e;if(n!=null)s='bgcolor="'+n+'"';else s="";if(t!=null&&t){o="color='red'><b>";vHLstr2="</b>"}else{o=">";vHLstr2=""}if(Cal.ShowTime){a="winMain.document.getElementById('"+Cal.Ctrl+"').value+=' '+"+"winMain.Cal.getShowHour()"+"+':'+"+"winMain.Cal.Minutes"+"+':'+"+"winMain.Cal.Seconds";if(TimeMode==12)a+="+' '+winMain.Cal.AMorPM"}else a="";i="<td "+s+" width="+CellWidth+" align='center'><font face='verdana' size='2'"+o+"<a href=\"javascript:winMain.document.getElementById('"+Cal.Ctrl+"').value='"+Cal.FormatDate(r)+"';"+a+';window.close();">'+r+"</a>"+vHLstr2+"</font></td>";return i}function Calendar(e,t){this.Date=e.getDate();this.Month=e.getMonth();this.Year=e.getFullYear();this.Hours=e.getHours();if(e.getMinutes()<10)this.Minutes="0"+e.getMinutes();else this.Minutes=e.getMinutes();if(e.getSeconds()<10)this.Seconds="0"+e.getSeconds();else this.Seconds=e.getSeconds();this.MyWindow=winCal;this.Ctrl=t;this.Format="ddMMyyyy";this.Separator=DateSeparator;this.ShowTime=false;if(e.getHours()<12)this.AMorPM="AM";else this.AMorPM="PM"}function GetMonthIndex(e){for(i=0;i<12;i++){if(MonthName[i].substring(0,3).toUpperCase()==e.toUpperCase()){return i}}}function IncYear(){Cal.Year++}function DecYear(){Cal.Year--}function SwitchMth(e){Cal.Month=e}function SetHour(e){var t;var n;if(TimeMode==24){t=23;n=0}else if(TimeMode==12){t=12;n=1}else alert("TimeMode can only be 12 or 24");var r=new RegExp("^\\d\\d$");if(r.test(e)&&parseInt(e,10)<=t&&parseInt(e,10)>=n){if(TimeMode==12&&Cal.AMorPM=="PM"){if(parseInt(e,10)==12)Cal.Hours=12;else Cal.Hours=parseInt(e,10)+12}else if(TimeMode==12&&Cal.AMorPM=="AM"){if(e==12)e-=12;Cal.Hours=parseInt(e,10)}else if(TimeMode==24)Cal.Hours=parseInt(e,10)}}function SetMinute(e){var t=new RegExp("^\\d\\d$");if(t.test(e)&&e<60)Cal.Minutes=e}function SetSecond(e){var t=new RegExp("^\\d\\d$");if(t.test(e)&&e<60)Cal.Seconds=e}function SetAmPm(e){this.AMorPM=e;if(e=="PM"){this.Hours=parseInt(this.Hours,10)+12;if(this.Hours==24)this.Hours=12}else if(e=="AM")this.Hours-=12}function getShowHour(){var e;if(TimeMode==12){if(parseInt(this.Hours,10)==0){this.AMorPM="AM";e=parseInt(this.Hours,10)+12}else if(parseInt(this.Hours,10)==12){this.AMorPM="PM";e=12}else if(this.Hours>12){this.AMorPM="PM";if(this.Hours-12<10)e="0"+(parseInt(this.Hours,10)-12);else e=parseInt(this.Hours,10)-12}else{this.AMorPM="AM";if(this.Hours<10)e="0"+parseInt(this.Hours,10);else e=this.Hours}}else if(TimeMode==24){if(this.Hours<10)e="0"+parseInt(this.Hours,10);else e=this.Hours}return e}function GetMonthName(e){var t=MonthName[this.Month];if(e)return t;else return t.substr(0,3)}function GetMonDays(){var e=[31,28,31,30,31,30,31,31,30,31,30,31];if(this.IsLeapYear()){e[1]=29}return e[this.Month]}function IsLeapYear(){if(this.Year%4==0){if(this.Year%100==0&&this.Year%400!=0){return false}else{return true}}else{return false}}function FormatDate(e){if(this.Format.toUpperCase()=="DDMMYYYY")return e+DateSeparator+(this.Month+1)+DateSeparator+this.Year;else if(this.Format.toUpperCase()=="DDMMMYYYY")return e+DateSeparator+this.GetMonthName(false)+DateSeparator+this.Year;else if(this.Format.toUpperCase()=="MMDDYYYY")return this.Month+1+DateSeparator+e+DateSeparator+this.Year;else if(this.Format.toUpperCase()=="MMMDDYYYY")return this.GetMonthName(false)+DateSeparator+e+DateSeparator+this.Year}var winCal;var dtToday=new Date;var Cal;var docCal;var MonthName=["January","February","March","April","May","June","July","August","September","October","November","December"];var WeekDayName=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var exDateTime;var cnTop="200";var cnLeft="500";var WindowTitle="DateTime Picker";var WeekChar=2;var CellWidth=20;var DateSeparator="-";var TimeMode=24;var ShowLongMonth=true;var ShowMonthYear=true;var MonthYearColor="#cc0033";var WeekHeadColor="#0099CC";var SundayColor="#6699FF";var SaturdayColor="#CCCCFF";var WeekDayColor="white";var FontColor="blue";var TodayColor="#FFFF33";var SelDateColor="#FFFF99";var YrSelColor="#cc0033";var ThemeBg="";Calendar.prototype.GetMonthIndex=GetMonthIndex;Calendar.prototype.IncYear=IncYear;Calendar.prototype.DecYear=DecYear;Calendar.prototype.SwitchMth=SwitchMth;Calendar.prototype.SetHour=SetHour;Calendar.prototype.SetMinute=SetMinute;Calendar.prototype.SetSecond=SetSecond;Calendar.prototype.SetAmPm=SetAmPm;Calendar.prototype.getShowHour=getShowHour;Calendar.prototype.GetMonthName=GetMonthName;Calendar.prototype.GetMonDays=GetMonDays;Calendar.prototype.IsLeapYear=IsLeapYear;Calendar.prototype.FormatDate=FormatDate